ProductName: sharepoint
Description: This test plan is for use with a Service Principal.  It will use PnP module as primary provided setting export tool.
TestPlan:
  - PolicyId: MS.SHAREPOINT.1.1v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.1.1v1 Non-compliant - ExternalUserAndGuestSharing (3)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.1.1v1 Non-compliant - ExternalUserSharingOnly (1)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.1.1v1 Compliant - ExistingExternalUserSharingOnly (2)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.1.1v1 Compliant - Disabled (0)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        ExpectedResult: true

  - PolicyId: MS.SHAREPOINT.1.2v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.1.2v1 Not Checked (PnP)
        Preconditions: []
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.1.3v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.1.3v1 Non-compliant - SharingCapability = ExternalUserSharingOnly (New and existing guests); SharingDomainRestrictionMode = BlockList
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              SharingDomainRestrictionMode: BlockList
              SharingBlockedDomainList: nefarious.com evil.is.us
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.1.3v1 Compliant -  SharingCapability = ExternalUserSharingOnly (New and existing guests); SharingDomainRestrictionMode = AllowList
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              SharingDomainRestrictionMode: AllowList
              SharingAllowedDomainList: good.org admirable.us
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.1.3v1 Compliant -  SharingCapability = ExternalUserAndGuestSharing (Anyone); SharingDomainRestrictionMode = AllowList
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              SharingDomainRestrictionMode: AllowList
              SharingAllowedDomainList: good.org admirable.us
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.1.3v1 Non-Applicable - SharingCapability = Disabled (Only people in organization);
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              SharingDomainRestrictionMode: None
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.1.3v1 Non-Applicable - SharingCapability = Disabled (Only people in organization); SharingDomainRestrictionMode = AllowList
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              SharingDomainRestrictionMode: AllowList
              SharingAllowedDomainList: good.org admirable.us
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.1.4v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.1.4v1 RequireAcceptingAccountMatchInvitedAccount Not-Implemented
        Preconditions: []
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.2.1v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.2.1v1 Non-compliant - DefaultSharingLinkType = None
        Preconditions:
          - Command: Set-PnPTenant
            Splat:
              DefaultSharingLinkType: None
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.2.1v1 Non-compliant - DefaultSharingLinkType = Internal
        Preconditions:
          - Command: Set-PnPTenant
            Splat:
              DefaultSharingLinkType: Internal
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.2.1v1 Non-compliant - DefaultSharingLinkType = AnonymousAccess
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              DefaultSharingLinkType: AnonymousAccess
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.2.1v1 Compliant - DefaultSharingLinkType = Direct
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              DefaultSharingLinkType: Direct
        Postconditions: []
        ExpectedResult: true

  - PolicyId: MS.SHAREPOINT.2.2v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.2.2v1 Non-compliant - DefaultLinkPermission = Edit
        Preconditions:
          - Command: Set-PnPTenant
            Splat:
              DefaultLinkPermission: Edit
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.2.2v1 Compliant - DefaultLinkPermission = View
        Preconditions:
          - Command: Set-PnPTenant
            Splat:
              DefaultLinkPermission: View
        Postconditions: []
        ExpectedResult: true

  - PolicyId: MS.SHAREPOINT.3.1v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing; RequireAnonymousLinksExpireInDays > 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 31
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); RequireAnonymousLinksExpireInDays < 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 7
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.3.1v1 Compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); RequireAnonymousLinksExpireInDays = 0 (Anyone links in unchecked state)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 0
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Compliant - SharingCapability = ExternalUserSharingOnly (New and existing guests); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Compliant - SharingCapability = ExistingExternalUserSharingOnly (Existing guests); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Compliant - SharingCapability = Disabled (Only people in your organization); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Applicable - SharingCapability = ExternalUserSharingOnly (New and existing guests); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Applicable - SharingCapability = ExistingExternalUserSharingOnly (Existing guests); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.1v1 Non-Applicable - SharingCapability = Disabled (Only people in your organization); RequireAnonymousLinksExpireInDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              RequireAnonymousLinksExpireInDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.3.2v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.3.2v1 Compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); FileAnonymousLinkType = View; FolderAnonymousLinkType = View
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
              WaitOnFirstCheck: True
          - Command: Set-PnPTenant
            Splat:
              FileAnonymousLinkType: View
              FolderAnonymousLinkType: View
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); FileAnonymousLinkType = Edit; FolderAnonymousLinkType = View
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
              WaitOnFirstCheck: True
          - Command: Set-PnPTenant
            Splat:
              FileAnonymousLinkType: Edit
              FolderAnonymousLinkType: View
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); FileAnonymousLinkType = View; FolderAnonymousLinkType = Edit
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
              WaitOnFirstCheck: True
          - Command: Set-PnPTenant
            Splat:
              FileAnonymousLinkType: View
              FolderAnonymousLinkType: Edit
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); FileAnonymousLinkType = Edit; FolderAnonymousLinkType = Edit
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
              WaitOnFirstCheck: True
          - Command: Set-PnPTenant
            Splat:
              FileAnonymousLinkType: Edit
              FolderAnonymousLinkType: Edit
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-Applicable - SharingCapability = Disabled (Only people in your organization)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-Applicable - SharingCapability = ExistingExternalUserSharingOnly (Existing guests)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.2v1 Non-Applicable - SharingCapability = ExternalUserSharingOnly (New and existing guests)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.3.3v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-Applicable - SharingCapability = ExistingExternalUserSharingOnly (Existing guests); EmailAttestationRequired = false; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: false
              EmailAttestationReAuthDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-compliant - SharingCapability = ExternalUserSharingOnly (New and existing guests); EmailAttestationRequired = false; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: false
              EmailAttestationReAuthDays: 30
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); EmailAttestationRequired = false; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: false
              EmailAttestationReAuthDays: 30
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-Applicable - SharingCapability = ExistingExternalUserSharingOnly (Existing guests); EmailAttestationRequired = true; EmailAttestationReAuthDays > 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 31
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-compliant - SharingCapability = ExternalUserSharingOnly (New and existing guests); EmailAttestationRequired = true; EmailAttestationReAuthDays > 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 31
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); EmailAttestationRequired = true; EmailAttestationReAuthDays > 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 31
        Postconditions: []
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-Applicable - SharingCapability = ExistingExternalUserSharingOnly (Existing guests); EmailAttestationRequired = true; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExistingExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExistingExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 30
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
      - TestDescription: MS.SHAREPOINT.3.3v1 Compliant - SharingCapability = ExternalUserSharingOnly (New and existing guests); EmailAttestationRequired = true; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserSharingOnly"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserSharingOnly'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 30
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.3.3v1 Compliant - SharingCapability = ExternalUserAndGuestSharing (Anyone); EmailAttestationRequired = true; EmailAttestationReAuthDays = 30
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability ExternalUserAndGuestSharing"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'ExternalUserAndGuestSharing'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 30
        Postconditions: []
        ExpectedResult: true
      - TestDescription: MS.SHAREPOINT.3.3v1 Non-Applicable - SharingCapability = Disabled (Only people in organization)
        Preconditions:
          - Command: SetAndCheckTenantSetting
            Splat:
              SetBlock: "Set-PnPTenant -SharingCapability Disabled"
              CheckBlock: "$(Get-PnPTenant).SharingCapability -eq 'Disabled'"
              Retries: 3
              WaitInterval: 10
          - Command: Set-PnPTenant
            Splat:
              EmailAttestationRequired: true
              EmailAttestationReAuthDays: 29
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false

  - PolicyId: MS.SHAREPOINT.4.2v1
    TestDriver: RunScuba
    Tests:
      - TestDescription: MS.SHAREPOINT.4.2v1 Non-compliant DenyAddAndCustomizePages Not-Implemented
        Preconditions: []
        Postconditions: []
        IsNotChecked: true
        ExpectedResult: false
